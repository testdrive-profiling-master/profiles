<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
	<style type="text/css"> 
		@import url(StarterKit.css);
	</style>
	<script type="application/javascript">
		var	led_power = [0.1, 0.3, 0.5, 0.7, 0, 0, 0, 0];
		function SetLED(led0, led1, led2, led3, led4, led5, led6, led7) {
			led_power[0]	= led0;
			led_power[1]	= led1;
			led_power[2]	= led2;
			led_power[3]	= led3;
			led_power[4]	= led4;
			led_power[5]	= led5;
			led_power[6]	= led6;
			led_power[7]	= led7;
		}
	</script>
</head>
<body>
	<div class="canvas_outer">
		<div class="canvas_inner">
			<canvas id="canvas" width="300" height="300" oncontextmenu='return false'>Your browser doesn't support canvas.</canvas>
			<script>
				(function() {
					var	htmlCanvas		= document.getElementById('canvas');
					var	ctx				= htmlCanvas.getContext('2d');
					var canvas_scale	= 1.0;
					var offset_x		= 0;
					var offset_y		= 0;
					var img_board		= new Image();

					initialize();

					function initialize() {
						img_board.src	= 'img/background.png';
			
						window.addEventListener('resize', resizeCanvas, false);
						resizeCanvas();
						setInterval(redraw, 30);
					}

					// Display custom canvas. In this case it's a blue, 5 pixel 
					// border that resizes along with the browser window.
					function redraw() {
						ctx.globalCompositeOperation = 'source-over';
						ctx.clearRect(0, 0, htmlCanvas.width, htmlCanvas.height); // 캔버스를 비운다

						{
							var scale_x = (htmlCanvas.width - 20) / img_board.width;
							var scale_y = (htmlCanvas.height - 20) / img_board.height;
							canvas_scale	= scale_x < scale_y ? scale_x : scale_y;
							if (canvas_scale <= 0) return;
						}
						
						ctx.save();
						offset_x	= (htmlCanvas.width - canvas_scale * img_board.width)/2;
						offset_y	= (htmlCanvas.height - canvas_scale * img_board.height)/2;
						ctx.translate(offset_x, offset_y);
						ctx.scale(canvas_scale, canvas_scale);
						ctx.drawImage(img_board, 0, 0);
						
						//ctx.translate(x_pos, y_pos);
						//ctx.drawImage(img_board, x_pos, y_pos, 20, 20);
						{
							ctx.save();
							ctx.globalCompositeOperation = 'lighter';
							ctx.globalAlpha = led_power[0];
							ctx.drawImage(img_board, 50, 50, 30, 30);
							ctx.globalAlpha = led_power[1];
							ctx.drawImage(img_board, 50+ 50, 50, 30, 30);
							ctx.globalAlpha = led_power[2];
							ctx.drawImage(img_board, 50+ 100, 50, 30, 30);
							ctx.globalAlpha = led_power[3];
							ctx.drawImage(img_board, 50+ 150, 50, 30, 30);

							// do something...
							ctx.restore();
						}
						ctx.restore();
					}

					function resizeCanvas() {
						htmlCanvas.width	= window.innerWidth;
						htmlCanvas.height	= window.innerHeight;
						redraw();
					}
					
					htmlCanvas.onmousedown = function(e) {
						mouseIsDown	= true;
						window.navigate("cmd://mouse.d." + String(parseInt((e.x - offset_x)/canvas_scale)) + "." + String(parseInt((e.y - offset_y)/canvas_scale)));
					}
					
					htmlCanvas.onmouseup = function(e) {
						if(mouseIsDown) {
							// click
							window.navigate("cmd://mouse.u." + String(parseInt((e.x - offset_x)/canvas_scale)) + "." + String(parseInt((e.y - offset_y)/canvas_scale)));
							mouseIsDown	= false;
						}
					}
				})();
			</script>
		</div>
	</div>
</body>
</html>